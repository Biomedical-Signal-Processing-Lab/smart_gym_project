# advice.py
from __future__ import annotations
from typing import Dict, List, Optional
import random

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Ï†êÏàò ‚Üí Î≤ÑÌÇ∑
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
def score_bucket(score: Optional[int]) -> str:
    s = 0 if score is None else int(score)
    if s <= 50:   return "danger"     # 0~50
    if s <= 70:   return "improve"    # 51~70
    if s <= 89:   return "good"       # 71~89
    return "perfect"                  # 90~100


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Í∏∞Î≥∏ Î©òÌä∏ (Ïö¥ÎèôÎ≥Ñ/Î≤ÑÌÇ∑Î≥Ñ)
# ÌïÑÏöî Ïãú ÏûêÏú†Î°≠Í≤å ÏàòÏ†ï/ÌôïÏû•
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
BASE: Dict[str, Dict[str, List[str]]] = {
    "squat": {
        "danger": [
            "Î¨¥Î¶éÏù¥ ÎÑàÎ¨¥ ÏïûÏúºÎ°ú ÎÇòÍ∞ÄÏöî! Î∞úÎÅùÏùÑ ÎÑòÏßÄ ÏïäÍ≤å.",
            "ÏóâÎç©Ïù¥Î•º Îçî Îí§Î°ú ÎπºÍ≥†, Ï§ëÏã¨ÏùÑ Î∞úÎí§ÍøàÏπòÎ°ú ÏòÆÍ≤®Î≥¥ÏÑ∏Ïöî.",
            "ÌóàÎ¶¨Í∞Ä ÎßêÎ¶¨Í≥† ÏûàÏñ¥Ïöî. Í∞ÄÏä¥ÏùÑ Îì§Í≥† Ï§ëÎ¶ΩÏ≤ôÏ∂î Ïú†ÏßÄ!"
        ],
        "improve": [
            "ÏûêÏÑ∏Í∞Ä Î∂àÏïàÏ†ïÌï¥Ïöî. ÏÜçÎèÑÎ•º Ï§ÑÏù¥Í≥† Ï§ëÏã¨ÏùÑ Ïû°ÏïÑÎ≥¥ÏÑ∏Ïöî.",
            "Î¨¥Î¶é Î∞©Ìñ•ÏùÑ Î∞îÍπ•ÏúºÎ°ú! Î∞úÍ≥º Î¨¥Î¶é ÎùºÏù∏ ÎßûÏ∂îÍ∏∞.",
            "Ï°∞Í∏àÎßå Îçî ÍπäÏù¥ ÏïâÍ≥† ÏΩîÏñ¥ Í∏¥Ïû• Ïú†ÏßÄ."
        ],
        "good": [
            "Í±∞Ïùò ÏôÑÎ≤ΩÌï¥Ïöî! Î¨¥Î¶é ÌùîÎì§Î¶ºÎßå Ï°∞Í∏à Ï§ÑÏó¨Î≥¥ÏÑ∏Ïöî.",
            "Ìûô Í∞ÅÎèÑ Ï¢ãÏïÑÏöî. ÌïòÍ∞ï ÏÜçÎèÑ ÏùºÏ†ïÌïòÍ≤å Ïú†ÏßÄÌïòÎ©¥ Ï¢ãÏïÑÏöî."
        ],
        "perfect": [
            "ÏôÑÎ≤Ω! Î¨¥Î¶é¬∑Ìûô Í∞ÅÎèÑ Ïù¥ÏÉÅÏ†ÅÏù¥ÏóêÏöî üëè",
            "Í∑†ÌòïÍ≥º ÍπäÏù¥ Î™®Îëê ÌõåÎ•≠Ìï©ÎãàÎã§."
        ],
    },

    "leg_raise": {
        "danger": [
            "ÌóàÎ¶¨Í∞Ä ÎúπÎãàÎã§! ÌóàÎ¶¨Í∞Ä Î∞îÎã•ÏóêÏÑú Îñ®Ïñ¥ÏßÄÏßÄ ÏïäÍ≤å Î≥µÎ∂ÄÏóê Ìûò.",
            "Îã§Î¶¨Î•º Í∏âÌïòÍ≤å ÎÇ¥Î¶¨Î©¥ ÌóàÎ¶¨Ïóê Î¨¥Î¶¨. Ï≤úÏ≤úÌûà ÌÜµÏ†úÌïòÏÑ∏Ïöî.",
            "Î≥µÎ∂Ä ÌûòÏù¥ ÌíÄÎ†∏Ïñ¥Ïöî. Î∞∞ÍºΩÏùÑ Î∞îÎã•ÏúºÎ°ú ÎàÑÎ•¥ÎìØ Í≥†Ï†ï!"
        ],
        "improve": [
            "ÌóàÎ¶¨Í∞Ä ÏÇ¥Ïßù Îì§Î†§Ïöî. ÏΩîÏñ¥Î°ú ÌóàÎ¶¨ ÎàåÎü¨ Í≥†Ï†ï!",
            "Îã§Î¶¨ Í∞ÅÎèÑÎ•º ÏùºÏ†ïÌïòÍ≤å‚ÄîÏÜçÎèÑ Ï†úÏñ¥Ïóê ÏßëÏ§ë.",
            "Í≥†Í¥ÄÏ†àÏóêÎßå ÌûòÏù¥ Î™∞Î†§Ïöî. Î≥µÎ∂ÄÎ°ú Îì§Ïñ¥Ïò¨Î¶¨ÏÑ∏Ïöî."
        ],
        "good": [
            "Ï¢ãÏïÑÏöî! ÏΩîÏñ¥ Í∏¥Ïû• Ïûò Ïú†ÏßÄ Ï§ë. ÌïòÍ∞ï ÏÜçÎèÑÎßå ÏùºÏ†ïÌïòÍ≤å.",
            "ÌóàÎ¶¨ ÏïàÏ†ïÏÑ± Ï¢ãÏïÑÏöî. ÎßàÏßÄÎßâ Íµ¨Í∞Ñ ÏßëÏ§ë!",
            "ÏûêÏÑ∏ ÍπîÎÅîÌï©ÎãàÎã§. 0.5Ï¥à Ï†ïÏßÄÎ°ú Ïª®Ìä∏Î°§ ÏóÖ."
        ],
        "perfect": [
            "ÏôÑÎ≤Ω! Î≥µÎ∂Ä Í∏¥Ïû•¬∑Îã§Î¶¨ Í∞ÅÎèÑ¬∑ÌóàÎ¶¨ Í≥†Ï†ï Î™®Îëê ÌõåÎ•≠Ìï¥Ïöî üëè",
            "ÏΩîÏñ¥ Ïª®Ìä∏Î°§Ïù¥ Ïù∏ÏÉÅÏ†ÅÏûÖÎãàÎã§.",
            "ÌîÑÎ°ú ÏàòÏ§ÄÏùò Î†àÍ∑∏ Î†àÏù¥Ï¶àÏòàÏöî!"
        ],
    },

    "shoulder_press": {
        "danger": [
            "ÌåîÍøàÏπòÍ∞Ä ÎÑàÎ¨¥ ÏïÑÎûòÎ°ú Îñ®Ïñ¥Ï†∏Ïöî. Ïñ¥Íπ® ÎùºÏù∏ ÏïÑÎûòÎ°ú ÎÇ¥Î†§Í∞ÄÏßÄ ÏïäÍ≤å!",
            "ÌóàÎ¶¨Í∞Ä Ï†ñÌòÄÏßëÎãàÎã§. ÏΩîÏñ¥ Ï°∞Ïù¥Í≥† Ï§ëÎ¶Ω Ïú†ÏßÄ.",
            "ÌåîÏù¥ ÎπÑÎåÄÏπ≠Ïù¥ÏóêÏöî. ÏñëÏ™Ω ÌåîÍøàÏπòÎ•º ÎèôÏùº Í∂§ÎèÑÎ°ú Ïò¨Î¶¨ÏÑ∏Ïöî."
        ],
        "improve": [
            "ÌåîÍøàÏπò Í∞ÅÎèÑÍ∞Ä Î∂àÏïàÏ†ïÌï¥Ïöî. ÏÜêÎ™©-ÌåîÍøàÏπò-Ïñ¥Íπ® ÏùºÏßÅÏÑ† Ï†ïÎ†¨.",
            "ÎÇ¥Î¶¥ Îïå ÏÜçÎèÑÎ•º ÎÇÆÏ∂îÍ≥† Î∞òÎèôÏùÑ Ï§ÑÏó¨Î≥¥ÏÑ∏Ïöî.",
            "ÌåîÍøàÏπòÍ∞Ä Î≤åÏñ¥Ï†∏Ïöî. ÏÇ¥Ïßù ÏïàÏ™ΩÏúºÎ°ú."
        ],
        "good": [
            "ÏïàÏ†ïÏ†Å! ÎÅù ÏßÄÏ†êÏóêÏÑú 0.5Ï¥à Î©àÏ∂§ÏúºÎ°ú Ïª®Ìä∏Î°§ ÏóÖ.",
            "ÌåîÍøàÏπò Í∂§Ï†Å Í±∞Ïùò ÏùºÏ†ï. ÏÇ¥ÏßùÎßå Îçî ÏïàÏ™ΩÏúºÎ°ú.",
            "Ïñ¥Íπ® ÏïàÏ†ïÏÑ± ÌõåÎ•≠. ÏôÑÏ†Ñ Ïù¥ÏôÑÏùÄ ÌîºÌïòÏÑ∏Ïöî."
        ],
        "perfect": [
            "ÏôÑÎ≤ΩÌïú Í∂§Ï†ÅÍ≥º ÎåÄÏπ≠! ÏΩîÏñ¥¬∑Ïñ¥Íπ® ÏïàÏ†ï ÌõåÎ•≠ üëè",
            "ÌîÑÎ°ú ÏàòÏ§Ä, ÌùîÎì§Î¶º ÏóÜÏù¥ Ï†ïÌôïÌïú ÎùºÏù∏.",
            "Î∞∏Îü∞Ïä§ÏôÄ Ìûò Ï†ÑÎã¨Ïù¥ Ïù¥ÏÉÅÏ†ÅÏûÖÎãàÎã§."
        ],
    },

    "lateral_raise": {
        "danger": [
            "ÌåîÏùÑ ÎÑàÎ¨¥ ÎÜíÏù¥ Îì§Ïñ¥Ïöî. Ïñ¥Íπ®Ïóê Î¨¥Î¶¨!",
            "Î∞òÎèôÏù¥ Ïª§Ïöî. ÏÉÅÏ≤¥ ÌùîÎì§Î¶º ÏóÜÏù¥ Ïò¨Î¶¨Í∏∞.",
            "ÏÜêÎ™©Ïù¥ Í∫æÏó¨Ïöî. Ìåî Ï†ÑÏ≤¥Î•º ÏùºÏßÅÏÑ†ÏúºÎ°ú."
        ],
        "improve": [
            "ÏñëÏ™Ω Ìåî ÎÜíÏù¥Î•º ÎßûÏ∂îÏÑ∏Ïöî. ÎåÄÏπ≠ Ïú†ÏßÄ.",
            "ÌåîÍøàÏπò ÏïΩÍ∞Ñ Íµ¨Î∂ÄÎ¶¨Í≥† Ïñ¥Íπ®Î°ú Îì§Ïñ¥Ïò¨Î¶¨Í∏∞.",
            "Ïñ¥Íπ®Î≥¥Îã§ ÏÜêÏù¥ Î®ºÏ†Ä Ïò¨ÎùºÍ∞ÄÏöî. ÌåîÍøàÏπòÎ•º Î¶¨ÎìúÎ°ú."
        ],
        "good": [
            "Ï¢ãÏïÑÏöî! Í∞ÅÎèÑ ÏïàÏ†ïÏ†Å. ÏÜçÎèÑ ÏùºÏ†ïÌïòÍ≤å Ïú†ÏßÄ.",
            "ÎåÄÏπ≠Ïù¥ Ïûò ÎßûÏïÑÏöî. ÎßàÎ¨¥Î¶¨ Íµ¨Í∞Ñ 0.5Ï¥à Î©àÏ∂§.",
            "Ïñ¥Íπ® Ï§ëÏã¨ÏúºÎ°ú Îì§Í≥† ÏûàÏñ¥Ïöî. ÏïÑÏ£º ÍπîÎÅîÌï¥Ïöî."
        ],
        "perfect": [
            "ÏôÑÎ≤Ω! Í∞ÅÎèÑ¬∑Í∂§Ï†Å¬∑ÎåÄÏπ≠ Î™®Îëê Ïù¥ÏÉÅÏ†Å üëè",
            "Î∞òÎèô ÏóÜÏù¥ Ïñ¥Íπ® ÌûòÏúºÎ°ú ÏôÑÏ†Ñ Ï†úÏñ¥.",
            "ÌîÑÎ°ú ÏàòÏ§ÄÏùò Î†àÌÑ∞Îü¥ Î†àÏù¥Ï¶àÏûÖÎãàÎã§."
        ],
    },

    "pushup": {
        "danger": [
            "ÌåîÍøàÏπòÍ∞Ä ÎÑàÎ¨¥ Î≤åÏñ¥Ï†∏Ïöî. Î™∏ÌÜµ Í∞ÄÍπåÏù¥Î°ú!",
            "ÌóàÎ¶¨Í∞Ä Í∫æÏûÖÎãàÎã§. ÏΩîÏñ¥ Ï°∞Ïù¥Í≥† Î™∏ ÏùºÏßÅÏÑ†.",
            "Î¨¥Î¶éÏù¥ ÌùîÎì§Î†§Ïöî. ÎùºÏù∏Î∂ÄÌÑ∞ ÏïàÏ†ïÌôîÌïòÏÑ∏Ïöî."
        ],
        "improve": [
            "ÌåîÍøàÏπò Í∞ÅÎèÑ ÏùºÏ†ïÌïòÍ≤å‚ÄîÏ≤úÏ≤úÌûà ÎÇ¥Î†§Í∞ÄÎ©∞ Ï†úÏñ¥.",
            "Î¨¥Î¶é ÌùîÎì§Î¶º Ï§ÑÏù¥Í≥† Ïñ¥Íπ®-ÏóâÎç©Ïù¥-Î¨¥Î¶é ÎùºÏù∏ Ïú†ÏßÄ.",
            "ÏÜêÎ™© ÏïÑÎûòÏóê ÌåîÍøàÏπòÍ∞Ä Ïò§ÎèÑÎ°ù Ï†ïÎ†¨ÌïòÏÑ∏Ïöî."
        ],
        "good": [
            "Ï¢ãÏïÑÏöî! ÏÉÅÏ≤¥ ÏõÄÏßÅÏûÑ ÏûêÏó∞Ïä§Îü¨ÏõÄ. Ìåî ÎåÄÏπ≠Îßå Ï°∞Í∏à Îçî.",
            "ÏΩîÏñ¥ ÏïàÏ†ï ÌõåÎ•≠. ÎßàÏßÄÎßâ Íµ¨Í∞Ñ Î≥µÎ∂Ä Í∏¥Ïû• Ïú†ÏßÄ!",
            "ÏÜçÎèÑ ÏùºÏ†ï, Î≤îÏúÑ Ï†ïÌôï. ÏïÑÏ£º Ï¢ãÏäµÎãàÎã§."
        ],
        "perfect": [
            "ÏôÑÎ≤ΩÌïú Ìë∏ÏãúÏóÖ! Í∞ÅÎèÑ¬∑ÏÜçÎèÑ¬∑ÎåÄÏπ≠ Ïù¥ÏÉÅÏ†Å üëè",
            "Î™∏ Ï†ÑÏ≤¥Í∞Ä ÏùºÏßÅÏÑ†, Ïª®Ìä∏Î°§ ÏµúÍ≥†.",
            "ÌîÑÎ°ú ÏàòÏ§ÄÏùò ÏàòÌñâÏù¥ÏóêÏöî."
        ],
    },

    "burpee": {
        "danger": ["ÏûêÏÑ∏Í∞Ä Î¨¥ÎÑàÏ†∏Ïöî. ÏÜçÎèÑÎ•º ÎÇÆÏ∂îÍ≥† Îã®Í≥ÑÎ≥ÑÎ°ú Ï†ïÌôïÌûà!"],
        "improve": ["Î∞òÎèô ÎåÄÏã† Í∑ºÏú°ÏúºÎ°ú. Ï∞©ÏßÄ¬∑Î≥µÍ∑Ä Î¶¨Îì¨ ÏùºÏ†ïÌïòÍ≤å."],
        "good": ["Ï¢ãÏïÑÏöî! Î¶¨Îì¨ Ïú†ÏßÄÌïòÍ≥† ÏΩîÏñ¥ Ï°∞Í∏à Îçî Ï°∞Ïù¥Í∏∞."],
        "perfect": ["ÏôÑÎ≤Ω! Î¶¨Îì¨¬∑Ï†ïÌôïÎèÑ Î™®Îëê ÌõåÎ•≠ üëè"],
    },

    "jumping_jack": {
        "danger": ["Ìåî/Îã§Î¶¨ Î≤îÏúÑÍ∞Ä Î∂àÏïàÏ†ï. ÎèôÏûë Ìè≠ÏùÑ ÏùºÏ†ïÌïòÍ≤å!"],
        "improve": ["Ìåî¬∑Îã§Î¶¨ ÌÉÄÏù¥Î∞ç ÎèôÍ∏∞Ìôî, Î∞òÎèô Ï§ÑÏù¥Í∏∞."],
        "good": ["Ï¢ãÏïÑÏöî! ÏÜçÎèÑ ÏùºÏ†ï, Î≤îÏúÑ Ïú†ÏßÄ."],
        "perfect": ["ÏôÑÎ≤Ω! ÌÉÄÏù¥Î∞çÍ≥º ÎåÄÏπ≠Ïù¥ ÌõåÎ•≠ üëè"],
    },

    "generic": {
        "danger": ["ÏúÑÌóòÌï©ÎãàÎã§. ÏÜçÎèÑÎ•º ÎÇÆÏ∂îÍ≥† Ï†ïÎ†¨ÏùÑ Î®ºÏ†Ä ÍµêÏ†ïÌïòÏÑ∏Ïöî."],
        "improve": ["Í∞úÏÑ† Ï§ë! Î≤îÏúÑÏôÄ ÏÜçÎèÑÎ•º ÏùºÏ†ïÌïòÍ≤å Ïú†ÏßÄÌï¥Î≥¥ÏÑ∏Ïöî."],
        "good": ["Ï¢ãÏäµÎãàÎã§. ÏÑ∏Î∂Ä Ï†ïÎ†¨Îßå Îã§Îì¨ÏúºÎ©¥ ÏôÑÎ≤ΩÌï¥Ïöî."],
        "perfect": ["ÏôÑÎ≤Ω! ÌòÑÏû¨ Ìå®ÌÑ¥ÏùÑ Ïú†ÏßÄÌïòÏÑ∏Ïöî üëè"],
    },
}


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# ÏÉÅÌô©Î≥Ñ Î≥¥Ï†ï ÌåÅ(ÏÑ†ÌÉùÏ†ÅÏúºÎ°ú ÎçßÎ∂ôÏûÑ)
# ctx={"elbow_not_deep": True, ...}
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
TIP_MAP: Dict[str, str] = {
    "elbow_not_deep":   "ÌåîÍøàÏπòÎ•º Îçî Ï†ëÏñ¥ ÍπäÏù¥Î•º ÌôïÎ≥¥ÌïòÏÑ∏Ïöî.",
    "elbow_flare":      "ÌåîÍøàÏπòÍ∞Ä Î≤åÏñ¥ÏßëÎãàÎã§. Î™∏ÌÜµ Í∞ÄÍπåÏù¥Î°ú.",
    "knee_more_extend": "Î¨¥Î¶éÏùÑ Îçî Ìé¥ ÏïàÏ†ïÏ†ÅÏù∏ ÎùºÏù∏ÏùÑ ÎßåÎì§Ïñ¥Ïöî.",
    "knee_valgus":      "Î¨¥Î¶éÏù¥ ÏïàÏ™ΩÏúºÎ°ú ÎßêÎ¶ΩÎãàÎã§. Î∞îÍπ• Ìñ•ÌïòÍ≤å.",
    "hip_back":         "ÏóâÎç©Ïù¥Î•º Îçî Îí§Î°ú ÎπºÏÑú Ï§ëÏã¨ÏùÑ Ïû°ÏïÑÎ≥¥ÏÑ∏Ïöî.",
    "back_arch":        "ÌóàÎ¶¨ Í≥ºÏã†Ï†Ñ Ï£ºÏùò! ÏΩîÏñ¥ Ï°∞Ïù¥Í≥† Ï§ëÎ¶Ω Ïú†ÏßÄ.",
    "tilt_instability": "ÏÉÅÏ≤¥ ÌùîÎì§Î¶ºÏù¥ Ïª§Ïöî. ÏÜçÎèÑÎ•º ÎÇÆÏ∂îÍ≥† Î∞òÎèô Í∏àÏßÄ.",
}


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Ï¶âÏãú Î∞òÎ≥µ Î∞©ÏßÄ ÏÑ†ÌÉùÍ∏∞: ÏßÅÏ†Ñ ÏÑ†ÌÉùÏùÄ Îã§Ïùå Ìò∏Ï∂úÏóêÏÑú Ï†úÏô∏
# ÌÇ§: (exercise, bucket)
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
class _RecentPicker:
    def __init__(self):
        # last_chosen[("squat","danger")] = "Î¨∏Íµ¨..."
        self.last_chosen: Dict[tuple, str] = {}
        self.rng = random.Random()

    def set_seed(self, seed: Optional[int]):
        if seed is not None:
            self.rng.seed(seed)

    def choose(self, exercise: str, bucket: str, candidates: List[str]) -> str:
        if not candidates:
            return ""

        key = (exercise, bucket)
        last = self.last_chosen.get(key)

        # ÌõÑÎ≥¥Í∞Ä 1Í∞úÎ©¥ Í∑∏ÎåÄÎ°ú Î∞òÌôò
        if len(candidates) == 1:
            chosen = candidates[0]
            self.last_chosen[key] = chosen
            return chosen

        # ÏßÅÏ†Ñ Î¨∏Íµ¨ Ï†úÏô∏Ìïú ÌõÑÎ≥¥ ÏÉùÏÑ±
        pool = [c for c in candidates if c != last] if last in candidates else candidates[:]

        # ÎßåÏïΩ Î™®Îëê Ï†úÏô∏ÎêòÏñ¥ Îπà Î¶¨Ïä§Ìä∏Í∞Ä ÎêêÎã§Î©¥(ÎèôÏùº Î¨∏Íµ¨ 1Í∞úÎßå ÏûàÎäî ÌäπÏàò ÏÉÅÌô©)
        if not pool:
            pool = candidates[:]

        chosen = self.rng.choice(pool)
        self.last_chosen[key] = chosen
        return chosen


_picker = _RecentPicker()


def set_random_seed(seed: Optional[int]) -> None:
    """ÌÖåÏä§Ìä∏/Ïû¨ÌòÑ Î™©Ï†ÅÏùò ÏãúÎìú Í≥†Ï†ï(ÏÑ†ÌÉùÏÇ¨Ìï≠)."""
    _picker.set_seed(seed)


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# ÎÇ¥Î∂Ä: Í∏∞Î≥∏ Î©òÌä∏ 1Í∞ú ÏÑ†ÌÉù(+Ï¶âÏãú Î∞òÎ≥µ Î∞©ÏßÄ)
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
def _pick_base(exercise: str, bucket: str) -> str:
    ex = exercise if exercise in BASE else "generic"
    arr = BASE.get(ex, {}).get(bucket) or BASE["generic"][bucket]
    return _picker.choose(ex, bucket, arr)


# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Í≥µÍ∞ú API: ÏµúÏ¢Ö ÏΩîÏπ≠ Î©òÌä∏ ÏÉùÏÑ±
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
def get_advice(exercise: str, score: Optional[int], ctx: Optional[Dict[str, bool]] = None) -> str:
    """
    exercise: "squat"|"leg_raise"|"shoulder_press"|"lateral_raise"|"pushup"|...
    score   : 0~100
    ctx     : {"elbow_not_deep": True, "knee_more_extend": True, ...}
    """
    bucket = score_bucket(score)
    base = _pick_base(exercise, bucket)

    if not ctx:
        return base

    tips = [TIP_MAP[k] for k, v in ctx.items() if v and k in TIP_MAP]
    if not tips:
        return base

    # Í∏∞Î≥∏ Î©òÌä∏ + Î≥¥Ï†ï ÌåÅ Í≤∞Ìï©
    return f"{base} " + " ".join(tips)
